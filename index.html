<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üö≠ Slutsnusat</title>
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1f2937; --card:rgba(255,255,255,0.06);
      --text:#fff; --muted:#cbd5e1; --accent:#3b82f6; --success:#22c55e;
      --barbg:rgba(255,255,255,0.15);
      --maxw:420px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),#0b1220 40%,var(--bg2) 100%);
      display:flex; flex-direction:column;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(15,23,42,.9); backdrop-filter:blur(8px);
      padding:16px; text-align:center; font-weight:700; letter-spacing:.3px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    main{flex:1; display:flex; justify-content:flex-start; overflow:auto}
    .container{width:100%; max-width:var(--maxw); margin:0 auto; padding:16px 16px 32px}
    h1{font-size:1.4rem; margin:8px 0 12px}
    h2{font-size:1.2rem; margin:18px 0 10px}
    label{display:block; margin:10px 0 6px; color:var(--muted)}
    input{
      width:100%; padding:12px; font-size:1rem; border:none; border-radius:12px;
      background:rgba(255,255,255,.08); color:var(--text); text-align:center;
      outline:2px solid transparent; outline-offset:2px;
    }
    input:focus{outline-color:var(--accent)}
    .btn{
      width:100%; padding:14px; border:none; border-radius:14px; cursor:pointer;
      font-weight:700; color:#fff; background:var(--accent);
      transition:transform .06s ease, filter .2s ease; margin-top:10px;
    }
    .btn:active{transform:scale(.99)}
    .btn.secondary{background:#64748b}
    .cards{
      margin-top:16px; display:grid; gap:10px;
    }
    .card{
      background:var(--card); border-radius:16px; padding:12px 14px;
      box-shadow:0 10px 30px rgba(0,0,0,.2);
    }
    .result-item{display:flex; justify-content:space-between; padding:8px 0; color:#e2e8f0}
    .ach-section{margin-top:18px; display:none;}
    .cat{
      margin-top:16px; padding:12px; border-radius:16px; background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
    }
    .cat-title{
      display:flex; align-items:center; gap:8px; margin:0 0 8px; font-weight:700;
    }
    .ach{
      margin:10px 0; padding:10px; border-radius:12px; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
    }
    .ach-top{display:flex; justify-content:space-between; gap:12px; align-items:center}
    .ach-name{font-size:.98rem}
    .ach-goal{font-size:.82rem; color:var(--muted)}
    .bar{height:12px; width:100%; background:var(--barbg); border-radius:999px; overflow:hidden; margin-top:8px}
    .fill{height:100%; width:0%; background:var(--accent); transition:width .5s ease}
    .meta{font-size:.8rem; color:#d1d5db; margin-top:4px; text-align:right}
    .unlocked{border-color:rgba(34,197,94,.7); background:rgba(34,197,94,.15)}
    .fill.done{background:var(--success)}
    .btn, input{min-height:44px}
  </style>
</head>
<body>
  <header>üö≠ Slutsnusat</header>
  <main>
    <div class="container">
      <h1>Din resa mot snusfri</h1>

      <div class="card">
        <label for="quitDate">Slutade snusa (datum)</label>
        <input type="date" id="quitDate"/>

        <label for="prillorPerDay">Prillor per dag</label>
        <input type="number" id="prillorPerDay" placeholder="t.ex. 20" inputmode="numeric"/>

        <label for="prisPerDosa">Pris per dosa (kr)</label>
        <input type="number" id="prisPerDosa" placeholder="t.ex. 50" inputmode="numeric"/>

        <button class="btn" onclick="calculate()">Ber√§kna framsteg</button>
        <button id="achBtn" class="btn secondary" onclick="toggleAchievements()">Visa achievements</button>
      </div>

      <div class="cards card" id="results" aria-live="polite">
        <h2>üìä Dina siffror</h2>
        <div class="result-item"><span>Antal dagar snusfri</span><strong id="r-days">‚Äì</strong></div>
        <div class="result-item"><span>Prillor undvikna</span><strong id="r-prillor">‚Äì</strong></div>
        <div class="result-item"><span>Dosor undvikna</span><strong id="r-dosor">‚Äì</strong></div>
        <div class="result-item"><span>Pengar sparade</span><strong id="r-money">‚Äì</strong></div>
      </div>

      <!-- Achievements -->
      <section class="ach-section" id="achievements">
        <h2>üéñÔ∏è Dina achievements</h2>

        <div class="cat" id="cat-time"><div class="cat-title">‚è≥ Tid</div></div>
        <div class="cat" id="cat-money"><div class="cat-title">üí∞ Ekonomi</div></div>
        <div class="cat" id="cat-prillor"><div class="cat-title">üì¶ Prillor & dosor</div></div>
        <div class="cat" id="cat-health"><div class="cat-title">üí™ H√§lsa</div></div>
      </section>

    </div>
  </main>

  <script>
    const ACHIEVEMENTS = [
      {id:'t1', cat:'time', name:'F√∂rsta dagen utan snus', metric:'days', goal:1},
      {id:'t2', cat:'time', name:'1 vecka snusfri', metric:'days', goal:7},
      {id:'t3', cat:'time', name:'2 veckor snusfri', metric:'days', goal:14},
      {id:'t4', cat:'time', name:'1 m√•nad snusfri', metric:'days', goal:30},
      {id:'t5', cat:'time', name:'2 m√•nader snusfri', metric:'days', goal:60},
      {id:'t6', cat:'time', name:'3 m√•nader snusfri', metric:'days', goal:90},
      {id:'t7', cat:'time', name:'6 m√•nader snusfri', metric:'days', goal:180},
      {id:'t8', cat:'time', name:'1 √•r snusfri', metric:'days', goal:365},
      {id:'m1', cat:'money', name:'100 kr sparade', metric:'money', goal:100},
      {id:'m2', cat:'money', name:'250 kr sparade', metric:'money', goal:250},
      {id:'m3', cat:'money', name:'500 kr sparade', metric:'money', goal:500},
      {id:'m4', cat:'money', name:'1 000 kr sparade', metric:'money', goal:1000},
      {id:'m5', cat:'money', name:'2 500 kr sparade', metric:'money', goal:2500},
      {id:'m6', cat:'money', name:'5 000 kr sparade', metric:'money', goal:5000},
      {id:'m7', cat:'money', name:'10 000 kr sparade', metric:'money', goal:10000},
      {id:'m8', cat:'money', name:'20 000 kr sparade', metric:'money', goal:20000},
      {id:'p1', cat:'prillor', name:'20 prillor undvikna', metric:'prillor', goal:20},
      {id:'p2', cat:'prillor', name:'50 prillor undvikna', metric:'prillor', goal:50},
      {id:'p3', cat:'prillor', name:'100 prillor undvikna', metric:'prillor', goal:100},
      {id:'p4', cat:'prillor', name:'250 prillor undvikna', metric:'prillor', goal:250},
      {id:'p5', cat:'prillor', name:'500 prillor undvikna', metric:'prillor', goal:500},
      {id:'p6', cat:'prillor', name:'1 000 prillor undvikna', metric:'prillor', goal:1000},
      {id:'p7', cat:'prillor', name:'5 000 prillor undvikna', metric:'prillor', goal:5000},
      {id:'p8', cat:'prillor', name:'10 000 prillor undvikna', metric:'prillor', goal:10000},
      {id:'h1', cat:'health', name:'Blodtrycket f√∂rb√§ttras', metric:'days', goal:1},
      {id:'h2', cat:'health', name:'Cirkulationen f√∂rb√§ttras', metric:'days', goal:7},
      {id:'h3', cat:'health', name:'Smak & luktsinne √•terh√§mtas', metric:'days', goal:14},
      {id:'h4', cat:'health', name:'Vilopuls stabiliseras', metric:'days', goal:30},
      {id:'h5', cat:'health', name:'Lungkapaciteten √∂kar', metric:'days', goal:90},
      {id:'h6', cat:'health', name:'Hud & energi f√∂rb√§ttras', metric:'days', goal:180},
    ];

    const cats = {
      time: document.getElementById('cat-time'),
      money: document.getElementById('cat-money'),
      prillor: document.getElementById('cat-prillor'),
      health: document.getElementById('cat-health'),
    };

    function createAchievementEl(a){
      const wrap = document.createElement('div'); wrap.className='ach'; wrap.id='ach-'+a.id;
      const top = document.createElement('div'); top.className='ach-top';
      const name = document.createElement('div'); name.className='ach-name'; name.textContent=a.name;
      const goal = document.createElement('div'); goal.className='ach-goal'; goal.textContent=goalLabel(a);
      top.appendChild(name); top.appendChild(goal);
      const bar = document.createElement('div'); bar.className='bar';
      const fill = document.createElement('div'); fill.className='fill'; fill.id='fill-'+a.id;
      bar.appendChild(fill);
      const meta = document.createElement('div'); meta.className='meta'; meta.id='meta-'+a.id; meta.textContent='0%';
      wrap.appendChild(top); wrap.appendChild(bar); wrap.appendChild(meta);
      return wrap;
    }

    function goalLabel(a){
      if(a.metric==='days')   return `${a.goal} dagar`;
      if(a.metric==='money')  return `${formatMoney(a.goal)} kr`;
      if(a.metric==='prillor')return `${formatInt(a.goal)} prillor`;
      return '';
    }

    ACHIEVEMENTS.forEach(a=>{
      cats[a.cat].appendChild(createAchievementEl(a));
    });

    function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
    function formatInt(n){return Math.round(n).toLocaleString('sv-SE');}
    function formatMoney(n){return Math.round(n).toLocaleString('sv-SE');}

    function calculate(){
      const quit = new Date(document.getElementById('quitDate').value);
      const prillorPerDay = parseFloat(document.getElementById('prillorPerDay').value);
      const prisPerDosa   = parseFloat(document.getElementById('prisPerDosa').value);

      if(!(quit instanceof Date) || isNaN(quit) || !prillorPerDay || !prisPerDosa){
        alert('Fyll i alla f√§lt.'); return;
      }

      const now = new Date();
      const daysPassed = Math.floor((now - quit)/(1000*60*60*24));
      const totalPrillor = Math.max(0, Math.floor(daysPassed * prillorPerDay));
      const totalDosor = totalPrillor/20;
      const totalSparat = totalDosor * prisPerDosa;

      document.getElementById('r-days').textContent   = formatInt(daysPassed);
      document.getElementById('r-prillor').textContent= formatInt(totalPrillor);
      document.getElementById('r-dosor').textContent  = totalDosor.toFixed(1).replace('.',',');
      document.getElementById('r-money').textContent  = `${formatMoney(totalSparat)} kr`;

      const metricVal = {
        days: Math.max(0, daysPassed),
        money: Math.max(0, totalSparat),
        prillor: Math.max(0, totalPrillor)
      };

      ACHIEVEMENTS.forEach(a=>{
        const cur = metricVal[a.metric];
        const pct = clamp((cur / a.goal) * 100, 0, 100);
        const fill = document.getElementById('fill-'+a.id);
        const meta = document.getElementById('meta-'+a.id);
        const wrap = document.getElementById('ach-'+a.id);

        fill.style.width = pct.toFixed(2) + '%';
        if(pct >= 100){ fill.classList.add('done'); wrap.classList.add('unlocked'); }
        else { fill.classList.remove('done'); wrap.classList.remove('unlocked'); }

        if(a.metric==='days'){
          meta.textContent = `${Math.min(a.goal, Math.max(0,cur))|0}/${a.goal} dagar (${Math.floor(pct)}%)`;
        } else if(a.metric==='money'){
          const curFmt = formatMoney(Math.min(a.goal, Math.max(0,cur)));
          meta.textContent = `${curFmt}/${formatMoney(a.goal)} kr (${Math.floor(pct)}%)`;
        } else {
          meta.textContent = `${formatInt(Math.min(a.goal, Math.max(0,cur)))}/${formatInt(a.goal)} prillor (${Math.floor(pct)}%)`;
        }
      });
    }

    function toggleAchievements(){
      const section = document.getElementById('achievements');
      const btn = document.getElementById('achBtn');
      if(section.style.display==='none' || section.style.display===''){
        section.style.display='block';
        btn.textContent="G√∂m achievements";
        section.scrollIntoView({behavior:'smooth', block:'start'});
      } else {
        section.style.display='none';
        btn.textContent="Visa achievements";
      }
    }
  </script>
</body>
</html>
